# 运气与机率 - 绝不输钱的马丁格尔套利策略\(汇总修正版）

外汇套利中的马丁格尔\(Martingale\)策略其实是一种赌博策略，这个方法其实早在十八世纪发源于法国之后没多久时间就在欧洲广为人知，理论上这种策略绝对不会输钱。

这个策略很简单，在一个压大或压小的赌盘里，一直不断的只压某一单边\(如压大或压小\)，每输钱一次，就把输钱的数目乘上两倍，一直到你的压盘赢一次，就可以将前面所亏损的金额全部赢回来并多赢第一次所压的金额。

让我们用实例来说明，假设我们来到澳门赌场，有一个只能压大小的台子，我们先从1元开始押\(只能压某一边\)，然后以2的倍数\(2x1\)n增加，也就是:1、2、4、8、16、32、64、128、256、512......，直到赢钱为止，然后又从头开始\(这样算一回合\)。

所以，每一回合，你一定会赢1元。如果你手上有1024元，每天进赌场要赢10元，那你每天只要赢10回合就可以快快乐乐过一天。目前世界上有一些赌场是不太欢迎赌徒使用此方法。但懂机率又不贪的人，常常使用这种方法进赌场去白吃白喝同时顺便观光旅游。

不过这个方法绝对不是稳赢不赔毫无风险，它的风险在于：有可能你还未赢到那「压对」的一次，口袋的钱已经亏光。比如以上面例子来说，如果一连压大，或一连压小都输了十次，那就是你会亏掉:1+2+4+8+16+32+54+128+256+512=1023 。你只剩一块钱，只好打电话叫你爸爸妈妈来带你回家。但就机率而言，要连开十次大，或连开十次小的确是不简单。

「机率」有所谓的单独机率\(Isolated probability\)跟

**连续机率**

\(continuous probability\)，而连续出现大，或连续出现小的机率是以指数\(Exponential\)递减。所以此方法有一句名言: 如果你有无限的财富，你就永远不会输钱。\(Never lose money if you have infinite wealth. \)

所以我们可以来算一下数学跟机率就可以看到一些有趣的现象。假设我们以q来代表亏损的机率\(如果仅以压大小为例是1/2，以美式轮盘为例是20/38\)，以B来代表口袋中能压大小的筹码总量，以n来代表总共能够亏损的次数。所以你总共亏损n次的机率是qn。当你把你口中的筹码都亏掉了，那表示你总共亏损的金额是:

![](http://www.ganatrader.com/ezcatfiles/nw28/img/img/644/advanced_02_001_01.png "运气与机率 &amp;lt;wbr&amp;gt;- &amp;lt;wbr&amp;gt;绝不输钱的马丁格尔套利策略\(汇总修正版）")

而你不会亏损n次的机率是1 − qn。假设你不会真的那么倒楣亏损了n次数，而你所能够赢到B数量的钱，那么你每一回合能期待的利润为: 

![](http://www.ganatrader.com/ezcatfiles/nw28/img/img/644/advanced_02_001_02.png "运气与机率 &amp;lt;wbr&amp;gt;- &amp;lt;wbr&amp;gt;绝不输钱的马丁格尔套利策略\(汇总修正版）")

所以，以上面例子来做说明，你会连续亏损10次的机率为:\(1/2\)^10=0.0009765= 0.09765%，所以第十一次你可以赢回所有的亏损并多赢1块钱的机率是 : 1-\(1/2\)^10= 99.9023%。 然而马丁格尔策略可以适用于股市/期货/外汇吗？基本上是可以，但天底下没有白吃的午餐，大部分交易者不喜欢使用这种策略来交易，原因是口袋不够深，无法承受连续数次的累计亏损。就我而言也不建议初学者使用此策略来做外汇交易，因为如果仅单独以此理论来做外汇交易，亏光户头里银子的机率很高。至于如何搭配使用此策略来战胜市场，内容比较深，我们不在这篇文章讨论。

  


这篇文章让我们来讨论一个问题，接续先篇文章所介绍的马丁格尔\(Martingale\)策略，可以使用在外汇交易上面吗？如果可以的话？怎么做才不会亏光口袋的银子？如果不可以又是为什么？

我们知道此方法是以「机率」来赢过压「大小」的赌盘。但在外汇市场里，我们可以把「大小」看成是「涨跌」吗？熟悉外汇的人都知道，市场的「涨跌」有时可不是赌大小的机率问题。使用马丁格尔策略其实最怕的就是当你进场做「买」时，市场却是一直不断的下跌，或是当你进场做「卖」时，市​​场却是一直不断的上涨，这都是时常发生的事。依照马丁格尔理论，因为到后面会越压越大，所以亏损到后期非常有可能将户头的资金全部亏光。所以由此可知，马丁格尔理论最适合用于「不断一直走震荡」的市场，反而最怕「不断一直走趋势」的市场。

我们可以来计算一下机率，不管是何种商品，一般的商品交易大概会有四种市场状况，就是「盘涨」 \(震荡上涨\)、盘跌\(震荡下跌\)， 大涨﹝趋势上涨﹞、 大跌﹝趋势下跌﹞。我们假设这四种市况会发生的机率都一样，所以它们出现的机率就是各占25%。就外汇市场来说也是一样有此四种情形。马丁格尔\(Martingale\)策略在「盘涨」跟「盘跌」的市场里都可以获利出场，就如同压大小的台子一样，开几次「大」后开「小」或开几次「小」后开「大」，使用马丁格尔策略都可以获利出场。但是在市况是大涨﹝趋势上涨﹞或大跌﹝趋势下跌﹞，只要是押错边，如趋势上涨时却执行马丁格尔策略的「卖」或都趋势下跌时却执行马丁格尔策略的「买」， 这时你进入「对的」市场的机率也是各占一半。所以，使用马丁格尔策略在任何市场「赢的机率」是75%，就是「盘涨」+「盘跌」+「大涨」 或「大跌」，输的机率是25%，就是「大涨」或「大跌」。同时，只要一进入「输的机率」的市场，那帐户里所有的钱亏光的机率几乎是100%。

因此我们才会说马丁格尔这种一直压下去的策略可能适合赌场，但却不一定适合外汇的货币交易。因为在外汇市况里，某种货币组合走趋势时，连续涨或连续跌一整年都是很常见，不过，如果仔细观察，我们就会发现有​​些货币常常处在震荡趋势，那就非常适合马丁格尔策略。

因此根据我的经验，马丁格尔策略要使用在外汇市场，一定要慎选货币之外，也要搭配其他的策略一起使用才不会「被烫到」。比如说，EUR/CHF 跟AUD/NZD这二组是使用马丁格尔策略的较佳货币。原因是EUR 跟CHF，AUD 跟NZD是高度连动\(Correlation\) 的货币。因此，这两组货币比其他的或币组都易处于「震荡」的市况，而比较不常处于所谓的「趋势」市况，读者可以自行查看历史就知道。

所以这两组货币是最常被马丁格尔策略爱好者所使用的货币！当然，这二组货币也是「红财神外汇套利自动交易系统」交易策略组合之一了。

  


先前的两篇文章，已经大略谈过马丁格尔的策略跟风险所在。这种策略虽然赌赢市场的机率高达75%，然而只要当市场与你是反方向的趋势线，那非常有可能会将帐户里所有的钱都亏光。马丁格尔策略也被称之为「金字塔型交易」 \(Pyramidical Trading\)，当它进场后遇到反市场趋势，因为越到后期开仓数越大，这时亏损也会变得越大。因此，使用此策略做市场套利者，一定要有一个可以「全身而退」的计画，以下是本人的一些建议供大家参考：

第一点是程式或策略本身需要有完整且考虑周详的「资产保护计画」。例如：设定当你进入的市场刚好与你的程式是反方向趋势时，当帐户亏损达到多少时可以停损出场。这点非常重要，因为如果不这样做，很容易会亏光帐户里所有的钱。

第二点是程式或策略本身可以在必要时启动「直接对冲」\(Direct Hedge\)。直接对冲的目的在规避反方向趋势时的不断扩大的亏损，并且「直接对冲」的开仓数是须经过数学运算过的，此目的不是为了获利而是为了缩小亏损出场。

第三点是「每三个月不管获利多少，一定要将利润全部汇回自己口袋」。也就是说，每一季汇回一次交易帐户的获利，一般而言三个月应该可以有15%至30%的获利。将所有获利汇回自己口袋后，帐户将只保留最原本投入的资金。当所有汇回的利润已超过原本投入的资金\(就是获利100%\)后，可改为每当获利达50%时汇回一次。当汇回的利润又达到投入的资金\(就是第二次的获利100%\)，可改为每获利达100%时汇回一次，之后就是每次达100%的获利时就汇回利润。

这样的机制，是针对应用马丁格尔套利策略时，发生反方向长趋势市场时的资金保护退场机制。它除了能有效保障利润之外，也比较不至于让自己的资金处于高度风险之中。

  


有关于马丁格尔理论的相关文章我已经在\(运气与机率\(1\) - 绝不输钱的马丁格尔套利策略\), \(运气与机率\(2\) - 续谈马丁格尔套利策略之与市场对赌\), 以及\(运气与机率\(3\) - 三谈马丁格尔套利策略之资金保护退场机制\)这三篇文章里简单的介绍过了，不过这篇文章我还是想再与读者讨论相关数学及机率理论部分的「方法学」，也会讨论在「资金管理学」上有名的凯莉公式\(Kelly Criterion\)。首先，我们先回顾何谓马丁格尔\(Martingale\)策略。所谓的马丁格尔\(Martingale\)策略其实是一种「赌博策略\(Betting strategy\)」。这个方法其实早在十八世纪发源于法国，当时有一对夫妇男的叫做马丁\(Martin\)女的叫格尔\(Gale\)。每个月当马丁\(Martin\)赚多少钱时格尔\(Gale\)就会把它花光并多花一些钱，这对夫妇发现如果这种情形一直下去，不久后他们将会破产。所以最后马丁格尔\(Martingale\)夫妇决定从此不管每个月当马丁\(Martin\)赚多少钱，格尔\(Gale\)每个月至少要留下一块钱。由此而衍生出了马丁格尔\(Martingale\)策略。策略很简单，就是任何在一个压大或压小的赌盘里，一直不断的只压某一单边\(如压大或压小\)，每输钱一次，就把输钱的数目乘上两倍，一直到你的压盘赢一次，就可以将前面所亏损的金额全部赢回来并多赢第一次所压的金额。

以下是使用数学机率所计算马丁格尔策略。假设我们以q来代表亏损的机率\(以美式轮盘为例是20/38，所以亏损机率为52.6% \)，以B来代表赌客口袋中能压大小的筹码总量，以n来代表总共能够亏损的次数。所以你总共亏损n次的机率是q^n。而当你把你手中的筹码都亏掉了，那表示你总共亏损的金额是:

![](http://www.ganatrader.com/ezcatfiles/nw28/img/img/644/advanced_02_001_01.png "运气与机率 &amp;lt;wbr&amp;gt;- &amp;lt;wbr&amp;gt;绝不输钱的马丁格尔套利策略\(汇总修正版）")

而你不会亏损n次的机率是1 − qn。假设你不会真的那么倒楣亏损了n次数，而你所能够赢到B数量的钱，那么你每一回合能期待的利润为:

![](http://www.ganatrader.com/ezcatfiles/nw28/img/img/644/advanced_02_001_02.png "运气与机率 &amp;lt;wbr&amp;gt;- &amp;lt;wbr&amp;gt;绝不输钱的马丁格尔套利策略\(汇总修正版）")

因为由上面的例子来说明，亏损的机率为52.6%，而上面公式中1 − \(2q\)^n = 1 - \(2\*52.6%\)^n，而且n 

&gt;

 0 \(n代表总共能够亏损的次数，因此n

&gt;

0\)，所以你会的到一个负值。这就表示在任何一次赌注里面，你所能期待的「利润」为负值，也就是说其「亏损的机率」会大于「获利的机率」。

若以实例来说明，假设我们拿6300元来到澳门赌场玩美国轮盘，我们先从100元开始押红色\( 18个红色与20个非红色，所以赢率为18/38，而输率为20/38 \)，然后以2的倍数\(2\)^n增加，也就是:100、200、400、800、1600、3200......，直到赢钱为止，然后又从头开始\(这样算一回合\)。如果你输了五次，那你会亏损100+200+400+800+1600 = 3100元，当你连续输到第六次，那你会亏光所有的钱\(3100+3200=6300\)。所以，以这个例子来做说明，你会连续亏损6次的机率为: \(20/38\)^6=2.1256%，而第六次你可以赢回所有的亏损并多赢1块钱的机率是: 1-\(20/38\)^6=97.8744%。

为何这次举的例子是以美国轮盘而非是压大小，且我举的例子是连续六次亏损而非连续八次亏损，九次亏损或者是十次亏损呢?

当然这部分跟外汇交易有关。在我的旧文章\(深入亚马逊丛林-外汇市场里的陷阱与骗局\)有做过分析，外汇投资者在外汇市场若以机率来看，赢率绝对是低于50%\(也就是亏损机率高于50%\)，所以应该以美国轮盘的输率52.6%来当成外汇的例子会比压大小的输率50%来的正确一点。另外，为何举「连续六次亏损」为例子呢? 因为「连续六次亏损」是最被赌徒视为「不可能机率」的一个临界点，这个在心理学上称为「典型启发」\( Representativeness Heuristic\)。不过我们来看实际的情形。以美国轮盘为例，其输率为q=20/38=52.6%，而「连续六次亏损」其「输的机率」变成: q^6 = 2.1256%。这是当我们以「单独连续性」六次亏损所算出来的机率。然而，如果我们再深入算下去，你会得到一个很意外的结果。

当我们进场赌73次的时候，你会在某个点上「连续六次亏损」的机率竟然会变成50.3% \(算法为: \(1-0.526316\)x0.021256 = 0.010069，0.978744 x \(1- 0.010069\)^67 = 0.49683，1-0.49683 = 50.3%\)。也就是假设你口袋仅有6300元每次压100元，以「马丁格尔」策略来压「美国轮盘」，在你压「美国轮盘」73次当中有一次会超过「连续六次亏损」的机率是50.3%。但马丁格尔策略是只要超过「连续六次亏损」这种情形发生一次，你就破产。且当你压美国轮盘150次当中有一次会超过「连续六次亏损」的机率则是77.2%，而若你压美国轮盘250次当中有一次会超过「连续六次亏损」的机率则变成91.1%。请注意，马丁格尔策略是只要发生「一次」高于你所能承受的最大亏损，你就破产。所以你玩越久且连续性越多次，破产机率就越高。

我们回过头来看一般的赌场。小的赌场可能一开始就限制你使用马丁格尔策略，但有些中大型赌场虽然允许你使用马丁格尔策略但却限制最多你只能压六次\(因为「典型启发」\)。赌场也不是笨蛋，他们都知道你所知道的所有技巧。由上面的数学你可以清楚知道，为何只要赌徒进了赌场坐下来长时间与赌场对赌，一般都是输光盘缠而回。而外汇市场或其他金融市场也可以被视为相类似情形，因为你是站在输的机率大于50%的一方，从数学机率理论来看，长期下来在市场成为输家的机率相当高。

接下来我们来谈「凯莉公式」\(Kelly Criterion\)。这个公式的目的是希望以机率方式来算出最合理的投资金额来让自己可以在长远的投资下是个「投资赢家」。假设有一个压大小赌盘，赢了就赢回所压的钱，输了则输去所压的钱。凯莉公式\(Kelly Criterion\)提出一个公式建议投资者应该以多少比率的资金来进行投资或押大小的赌盘。公式如下:

f\*=（bp-q\)/b

以上公式之:

f\*为压在赌注上的全部资金比率\(例如若为10%，当你有100元时，就表示最多只能拿100\*10%=10元下注\)。

b为赌盘上的净赔率\(一般是设赔率为一，就是b = 1\)。

p为赌盘上赢的机率。

q为赌盘上输的机率。它也等于1 − p。

由上面的公式，我们假设有一个赔率是1比1\(b=1\)的赌盘，因为b=1，所以上面的公式就变成:

f\*=p-q

我们再假设如果该赌盘赢的机率是60%而输的机率是40%，也就是上面公式中的p=0.6 而q=0.4，若我们想成为「长期的赢家」，我们每次下注的金额为资金总金额的:

f\*=0.6-0.4 =0.2 = 20%

也就是说，在上面这个赌盘条件下，只要你每次下注是低于你资产总金额的20%，你就可以成为「长期的赢家」。

不过使用「凯莉公式」有一个条件，就是当f\*是一个负值时，这个赌盘就变成不适用。f\*如何会变负值?当b 

&lt;

 q/p时，f\*就变成负值。也就是说在任何赔率\(b\)小于输率除以赢率的赌盘，f\*就变成负值。例如，以「美国轮盘」为例，其赔率是1比1，所以b=1。但输率为q=20/38=52.6%，而赢率为p=18/38=48.4%，所以b\(=1\) 

&lt;

 52.6/48.4。就以上面公式套到「美国轮盘」来说，其结果如下所示。

f\* = 18/38 - 20/38 = -1/19

以上f\*变成负值。因此若以「凯莉公式」的建议，那就是「不要玩美国轮盘」。因为在这种条件下的赌盘你是无论如何都不可能成为「长期的赢家」。

同时「凯莉公式」对连续赌注的每一笔赌注事实上是设为一个独立机率\(Independent\)，而且「凯莉公式」仅对每一笔赌注的最小投资额做建议，它不是产生递增现象，而是平均分摊的模式，再依照机率下算出来的结果，以最佳的资金达到长期获利的效果。

所以假设我们要利用「马丁格尔」与「凯莉公式」在外汇上操作，我们应该如何设计一个合适的「资金管理」来让我们的程式可以达到「长期的赢家」?

我们来看「红财神外汇自动交易程式」在「资金管理」上的设计。我们依照前面「马丁格尔」策略论述里所谈到的「典型启发」\(Representativeness Heuristic\)为「连续六次亏损」。所以资金的设计就是以七次「连续亏损」为基准。同时在传统的「马丁格尔」策略是以2^n为乘积，但实际做法上2^n的递增操作模式在外汇市场是极为高风险，因此「红财神外汇自动交易程式」建议是以1.3 ~1.5之间为乘积。我们将统一以1.3为例子。所以，以下简单的数学运算当:

x = lot 

y = Multiplier \(乘积\) 

所以: 

Level 1 = x 

Level 2 = xy 

Level 3 = xy2 

Level 4 = xy3 

Level 5 = xy4 

Level 6 = xy5 

Level 7 = xy6

当你达到第七阶时，就是「连续亏损七次」后你所开的总Lot数为: 

x + xy + xy2 + xy3 + xy4 + xy5 + xy6 

由以上公式，当我们设定程式为:

x = 0.01 lot 

y = 1.3 \(乘积\) 

所以: 

Level 1 = 0.01 

Level 2 = 0.02 

Level 3 = 0.03 

Level 4 = 0.04 

Level 5 = 0.05 

Level 6 = 0.07 

Level 7 = 0.09

当你达到第七阶时，就是「连续亏损七次」后你所开的总Lot数为: 0.01 + 0.02 + 0.03 + 0.04 + 0.05 +0.07 + 0.09 = 0.31 Lot 所以，若我们是在一个允许1 :100的杠杆下的外汇经纪商交易，若我们只使用10%的Margin，那安全的操作资金就需要3100美金。

  


若我们以「典型启发」\(Representativeness Heuristic\)之「连续六次亏损」为标准，达到第六阶时的总开仓数目= 0.01 + 0.02 + 0.03 + 0.04 + 0.05 +0.07 = 0.22 Lot，若我们只使用10%的Margin，所以我们建议使用「红财神外汇自动交易程式」的最低资金要求则为2500美金。因此在我们的程式设定上，常常将Break Even阶层设为第六层而开始对冲层则设为第七层就是这个原因。

接下来就是讨论应该设多少资金为我们应该投入的资金才能成为「长期的赢家」? 我们来回头来看「凯莉公式」。我们知道马丁格尔策略在任何的金融市场赢率为75%\(盘涨，盘跌，大涨或大跌\)，而输率为25%\(大涨或大跌\)，因此我们下注的金额应该为资金总金额的:

f\* = 0.75-0.25 =0.5 = 50%

所以，在「红财神外汇自动交易程式」的PairStopLossPercent栏位上我们建议都是设为50\(50%\)或60\(60%\)，因为我们为了成为「长期的赢家」，我们就必须设每次回合的马丁格尔交易资金必须低于「凯莉公式」的资金建议。

当然现在版本\(5.3\)的「红财神外汇自动交易程式」已经增加了更多的保护机制，例如对冲以及小额亏损出场等等，种种的防护机制其实就是为了投资者在真正交易时，能保护资金进而成为「长期的赢家」。

